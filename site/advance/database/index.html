



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A lightweight node.js serverless framework">
      
      
        <link rel="canonical" href="https://reflex-media.github.io/lesgo-docs/0.6.3/advance/database/">
      
      
        <meta name="author" content="Sufiyan Rahmat">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-4.1.1">
    
    
      
        <title>Database - Lesgo!</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.3020aac5.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="orange">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#database" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://reflex-media.github.io/lesgo-docs/0.6.3" title="Lesgo!" class="md-header-nav__button md-logo">
          
            <i class="md-icon">cloud</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Lesgo!
            </span>
            <span class="md-header-nav__topic">
              Database
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/reflex-media/lesgo/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    reflex-media/lesgo
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://reflex-media.github.io/lesgo-docs/0.6.3" title="Lesgo!" class="md-nav__button md-logo">
      
        <i class="md-icon">cloud</i>
      
    </a>
    Lesgo!
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/reflex-media/lesgo/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    reflex-media/lesgo
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Prologue" class="md-nav__link">
      Prologue
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/structure/" title="Directory Structure" class="md-nav__link">
      Directory Structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/deployment/" title="Deployment" class="md-nav__link">
      Deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../getting-started/available-scripts/" title="Available Scripts" class="md-nav__link">
      Available Scripts
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      The Basics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        The Basics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/middleware/" title="Middleware" class="md-nav__link">
      Middleware
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/error-handling/" title="Error Handling" class="md-nav__link">
      Error Handling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basics/logging/" title="Logging" class="md-nav__link">
      Logging
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Digging Deeper
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Digging Deeper
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cache/" title="Cache" class="md-nav__link">
      Cache
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Database
      </label>
    
    <a href="./" title="Database" class="md-nav__link md-nav__link--active">
      Database
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rds-aurora-serverless-database" title="RDS Aurora Serverless Database" class="md-nav__link">
    RDS Aurora Serverless Database
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration" title="Configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-queries" title="Basic Queries" class="md-nav__link">
    Basic Queries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-prepared-statement" title="Using Prepared Statement" class="md-nav__link">
    Using Prepared Statement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#available-methods" title="Available methods" class="md-nav__link">
    Available methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dbselect" title="db.select" class="md-nav__link">
    db.select
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dbselectfirst" title="db.selectFirst" class="md-nav__link">
    db.selectFirst
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dbselectpaginate" title="db.selectPaginate" class="md-nav__link">
    db.selectPaginate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dbinsert" title="db.insert" class="md-nav__link">
    db.insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dbupdate" title="db.update" class="md-nav__link">
    db.update
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-dynamodb" title="AWS DynamoDb" class="md-nav__link">
    AWS DynamoDb
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration_1" title="Configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-queries_1" title="Basic Queries" class="md-nav__link">
    Basic Queries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-custom-queries" title="Using Custom Queries" class="md-nav__link">
    Using Custom Queries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#available-methods_1" title="Available Methods" class="md-nav__link">
    Available Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dynamodbquerycount" title="dynamodb.queryCount" class="md-nav__link">
    dynamodb.queryCount
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamodbput" title="dynamodb.put" class="md-nav__link">
    dynamodb.put
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamodbupdate" title="dynamodb.update" class="md-nav__link">
    dynamodb.update
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helpers/" title="Helpers" class="md-nav__link">
      Helpers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../object-store/" title="Object Store" class="md-nav__link">
      Object Store
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queues/" title="Queues" class="md-nav__link">
      Queues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../task-scheduling/" title="Task Scheduling" class="md-nav__link">
      Task Scheduling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../unit-tests/" title="Unit Tests" class="md-nav__link">
      Unit Tests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../full-text-search/" title="Full-Text Search" class="md-nav__link">
      Full-Text Search
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../typescript/" title="Typescript" class="md-nav__link">
      Typescript
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Security
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Security
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../security/vpc/" title="VPC" class="md-nav__link">
      VPC
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Packages
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Packages
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../packages/firebase/" title="Firebase" class="md-nav__link">
      Firebase
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../contributing/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rds-aurora-serverless-database" title="RDS Aurora Serverless Database" class="md-nav__link">
    RDS Aurora Serverless Database
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration" title="Configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-queries" title="Basic Queries" class="md-nav__link">
    Basic Queries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-prepared-statement" title="Using Prepared Statement" class="md-nav__link">
    Using Prepared Statement
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#available-methods" title="Available methods" class="md-nav__link">
    Available methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dbselect" title="db.select" class="md-nav__link">
    db.select
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dbselectfirst" title="db.selectFirst" class="md-nav__link">
    db.selectFirst
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dbselectpaginate" title="db.selectPaginate" class="md-nav__link">
    db.selectPaginate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dbinsert" title="db.insert" class="md-nav__link">
    db.insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dbupdate" title="db.update" class="md-nav__link">
    db.update
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-dynamodb" title="AWS DynamoDb" class="md-nav__link">
    AWS DynamoDb
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration_1" title="Configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-queries_1" title="Basic Queries" class="md-nav__link">
    Basic Queries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-custom-queries" title="Using Custom Queries" class="md-nav__link">
    Using Custom Queries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#available-methods_1" title="Available Methods" class="md-nav__link">
    Available Methods
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dynamodbquerycount" title="dynamodb.queryCount" class="md-nav__link">
    dynamodb.queryCount
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamodbput" title="dynamodb.put" class="md-nav__link">
    dynamodb.put
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamodbupdate" title="dynamodb.update" class="md-nav__link">
    dynamodb.update
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/reflex-media/lesgo/edit/master/docs/advance/database.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="database">Database<a class="headerlink" href="#database" title="Permanent link">&para;</a></h1>
<p>As of today, Lesgo! only supports AWS DynamoDb and AWS Aurora Database Serverless, as these are the only true serverless database services available on AWS.</p>
<h2 id="rds-aurora-serverless-database">RDS Aurora Serverless Database<a class="headerlink" href="#rds-aurora-serverless-database" title="Permanent link">&para;</a></h2>
<h3 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h3>
<p>The database configuration for your application is located at <code>src/config/db.js</code>.</p>
<p>You may also simply update the respective environment files in <code>config/environments/*</code> as such:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># AWS Secret Manager ARN to allow app db user connect to the specified db</span>
<span class="nv">DB_SECRET_ARN</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="c1"># AWS Secret Manager ARN to allow app command db user connect to the specified db</span>
<span class="c1"># for running &quot;command&quot; like functions like database schema migration</span>
<span class="nv">DB_SECRET_COMMAND_ARN</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="c1"># AWS Secret Manager ARN for the Aurora Serverless database cluster</span>
<span class="nv">DB_RESOURCE_ARN</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

<span class="c1"># Database name to connect to</span>
<span class="nv">DB_NAME</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</code></pre></div>

<h3 id="basic-queries">Basic Queries<a class="headerlink" href="#basic-queries" title="Permanent link">&para;</a></h3>
<p>To run a basic query, you may use the query method on the <code>Utils/db</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span> <span class="nx">db</span> <span class="kr">from</span> <span class="s2">&quot;Utils/db&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM users&quot;</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm">[</span>
<span class="cm">  {</span>
<span class="cm">    id: 1,</span>
<span class="cm">    username: &#39;John Doe&#39;,</span>
<span class="cm">  },</span>
<span class="cm">  {</span>
<span class="cm">    id: 2,</span>
<span class="cm">    username: &#39;Jane Doe&#39;,</span>
<span class="cm">  },</span>
<span class="cm">  ...</span>
<span class="cm">]</span>
<span class="cm">*/</span>
</code></pre></div>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>While it is OK to write raw queries with values inserted directly in the query statement, note that this is risky. Use prepared statement as show below as much as possible.</p>
</div>
<h3 id="using-prepared-statement">Using Prepared Statement<a class="headerlink" href="#using-prepared-statement" title="Permanent link">&para;</a></h3>
<p>You should always use prepared statement for your queries.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span> <span class="nx">db</span> <span class="kr">from</span> <span class="s2">&quot;Utils/db&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM users WHERE id = :id LIMIT 1&quot;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">id</span><span class="o">:</span> <span class="mf">1</span><span class="p">,</span>
<span class="p">});</span>

<span class="cm">/**</span>
<span class="cm">[</span>
<span class="cm">  {</span>
<span class="cm">    id: 1,</span>
<span class="cm">    username: &#39;John Doe&#39;,</span>
<span class="cm">  },</span>
<span class="cm">  {</span>
<span class="cm">    id: 2,</span>
<span class="cm">    username: &#39;Jane Doe&#39;,</span>
<span class="cm">  },</span>
<span class="cm">  ...</span>
<span class="cm">]</span>
<span class="cm">*/</span>
</code></pre></div>

<h3 id="available-methods">Available methods<a class="headerlink" href="#available-methods" title="Permanent link">&para;</a></h3>
<p>The <code>Utils/db</code> also comes with more specific and granular methods for specific queries.</p>
<p>Refer to <a href="https://www.npmjs.com/package/data-api-client">data-api-client</a> npm package for additioal details.</p>
<h4 id="dbselect">db.select<a class="headerlink" href="#dbselect" title="Permanent link">&para;</a></h4>
<p>This will return an array of Objects</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span> <span class="nx">db</span> <span class="kr">from</span> <span class="s2">&quot;Utils/db&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">darta</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM users WHERE is_deleted = :isDeleted&quot;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">isDeleted</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">});</span>

<span class="cm">/**</span>
<span class="cm">[</span>
<span class="cm">  {</span>
<span class="cm">    id: 1,</span>
<span class="cm">    username: &#39;John Doe&#39;,</span>
<span class="cm">    is_deleted: false,</span>
<span class="cm">  },</span>
<span class="cm">  {</span>
<span class="cm">    id: 2,</span>
<span class="cm">    username: &#39;Jane Doe&#39;,</span>
<span class="cm">    is_deleted: false,</span>
<span class="cm">  },</span>
<span class="cm">  ...</span>
<span class="cm">]</span>
<span class="cm">*/</span>
</code></pre></div>

<h4 id="dbselectfirst">db.selectFirst<a class="headerlink" href="#dbselectfirst" title="Permanent link">&para;</a></h4>
<p>This will return only a single record</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span> <span class="nx">db</span> <span class="kr">from</span> <span class="s2">&quot;Utils/db&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">selectFirst</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM users WHERE id = :id&quot;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">id</span><span class="o">:</span> <span class="mf">1</span><span class="p">,</span>
<span class="p">});</span>

<span class="cm">/**</span>
<span class="cm">{</span>
<span class="cm">  id: 1,</span>
<span class="cm">  username: &#39;John Doe&#39;,</span>
<span class="cm">}</span>
<span class="cm">*/</span>
</code></pre></div>

<h4 id="dbselectpaginate">db.selectPaginate<a class="headerlink" href="#dbselectpaginate" title="Permanent link">&para;</a></h4>
<p>This will return a paginated response</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span> <span class="nx">db</span> <span class="kr">from</span> <span class="s2">&quot;Utils/db&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">paginatedData</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">selectPaginate</span><span class="p">(</span>
  <span class="s2">&quot;SELECT * FROM users WHERE id = :id&quot;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="mf">1</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">perPage</span><span class="o">:</span> <span class="mf">3</span><span class="p">,</span>
    <span class="nx">currentPage</span><span class="o">:</span> <span class="mf">1</span><span class="p">,</span>
    <span class="nx">total</span><span class="o">:</span> <span class="mf">100</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm">{</span>
<span class="cm">  count: 25,</span>
<span class="cm">  previous_page: 1,</span>
<span class="cm">  current_page: 1,</span>
<span class="cm">  next_page: 2,</span>
<span class="cm">  last_page: 34,</span>
<span class="cm">  per_page: 5,</span>
<span class="cm">  total: 100,</span>
<span class="cm">  items: [</span>
<span class="cm">    {</span>
<span class="cm">      id: 1,</span>
<span class="cm">      username: &#39;John Doe&#39;,</span>
<span class="cm">    },</span>
<span class="cm">    {</span>
<span class="cm">      id: 2,</span>
<span class="cm">      username: &#39;Jane Doe&#39;,</span>
<span class="cm">    },</span>
<span class="cm">    {</span>
<span class="cm">      id: 3,</span>
<span class="cm">      username: &#39;Salmah Hayek&#39;,</span>
<span class="cm">    }</span>
<span class="cm">  ],</span>
<span class="cm">}</span>
<span class="cm">*/</span>
</code></pre></div>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If <code>total</code> is not provided, <code>db.selectPaginate</code> will execute the given query and calculate the total record count by calculating the length of the resulset with <code>.length</code>. It is highly recommended to provide the <code>total</code> to avoid this resource intensive process.</p>
</div>
<h4 id="dbinsert">db.insert<a class="headerlink" href="#dbinsert" title="Permanent link">&para;</a></h4>
<p>This will insert a new record and return only the newly inserted primary key</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span> <span class="nx">db</span> <span class="kr">from</span> <span class="s2">&quot;Utils/db&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">insertId</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span>
  <span class="s2">&quot;INSERT INTO users(username,email,created_at) VALUES (:username, :email:, now())&quot;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">username</span><span class="o">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span>
    <span class="nx">email</span><span class="o">:</span> <span class="s2">&quot;john@mail.com&quot;</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// 1</span>
</code></pre></div>

<h4 id="dbupdate">db.update<a class="headerlink" href="#dbupdate" title="Permanent link">&para;</a></h4>
<p>This will update an existing record. Will throw an Error if no record found for update</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span> <span class="nx">db</span> <span class="kr">from</span> <span class="s2">&quot;Utils/db&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">insertId</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span>
  <span class="s2">&quot;UPDATE users SET username=:username, email=:email, updated_at=now()) WHERE id=:id&quot;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="mf">1</span><span class="p">,</span>
    <span class="nx">username</span><span class="o">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span>
    <span class="nx">email</span><span class="o">:</span> <span class="s2">&quot;john@mail.com&quot;</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">);</span>
</code></pre></div>

<h2 id="aws-dynamodb">AWS DynamoDb<a class="headerlink" href="#aws-dynamodb" title="Permanent link">&para;</a></h2>
<p>If you'd prefer a non-relational database, DynamoDb is also supported.</p>
<h3 id="configuration_1">Configuration<a class="headerlink" href="#configuration_1" title="Permanent link">&para;</a></h3>
<p>Before you can start to use DynamoDb, you need to set it up under the <code>config/resources/</code> directory. Also include the newly created yml file in the <code>serverless.yml</code> under the <code>resources</code> section.</p>
<blockquote>
<p><code>config/resources/dynamodb.yml</code></p>
</blockquote>
<div class="codehilite"><pre><span></span><code>Resources:
  settingsTable:
    Type: AWS::DynamoDB::Table
    DeletionPolicy: Retain
    Properties:
      TableName: ${self:provider.stackName}-settings
      AttributeDefinitions:
        - AttributeName: siteId
          AttributeType: S
        - AttributeName: checkType
          AttributeType: S
      KeySchema:
        - AttributeName: siteId
          KeyType: HASH
        - AttributeName: checkType
          KeyType: RANGE
      BillingMode: PAY_PER_REQUEST
</code></pre></div>

<blockquote>
<p><code>serverless.yml</code></p>
</blockquote>
<div class="codehilite"><pre><span></span><code>resources:
  - ${file(${self:custom.path.resources}/dynamodb.yml)}
</code></pre></div>

<h3 id="basic-queries_1">Basic Queries<a class="headerlink" href="#basic-queries_1" title="Permanent link">&para;</a></h3>
<p>To run a basic query, you may use the query method on the <code>Utils/dynamodb</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span> <span class="nx">dynamodb</span> <span class="kr">from</span> <span class="s2">&quot;Utils/dynamodb&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">dynamodb</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span>
  <span class="s1">&#39;stackName-settings&#39;</span><span class="p">,</span>
  <span class="s1">&#39;siteId = :siteId&#39;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="s1">&#39;:siteId&#39;</span><span class="o">:</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="s1">&#39;siteId, checkType&#39;</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm">[</span>
<span class="cm">  {</span>
<span class="cm">    siteId: &#39;site1&#39;,</span>
<span class="cm">    checkType: &#39;text&#39;,</span>
<span class="cm">  },</span>
<span class="cm">  {</span>
<span class="cm">    siteId: &#39;site2&#39;,</span>
<span class="cm">    checkType: &#39;photo&#39;,</span>
<span class="cm">  },</span>
<span class="cm">  ...</span>
<span class="cm">]</span>
<span class="cm">*/</span>
</code></pre></div>

<h3 id="using-custom-queries">Using Custom Queries<a class="headerlink" href="#using-custom-queries" title="Permanent link">&para;</a></h3>
<p>You can also pass your own query if needed through the <code>client</code> property, refer to <code>query</code> method's <a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB/DocumentClient.html#query-property">first parameter</a>.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span> <span class="nx">dynamodb</span> <span class="kr">from</span> <span class="s2">&quot;Utils/dynamodb&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">dynamodb</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>
  <span class="nx">ExpressionAttributeValues</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;:siteId&#39;</span><span class="o">:</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
    <span class="s1">&#39;siteId, checkType&#39;</span>
  <span class="p">},</span>
  <span class="nx">KeyConditionExpression</span><span class="o">:</span> <span class="s2">&quot;siteId = :siteId&quot;</span><span class="p">,</span> 
  <span class="nx">ProjectionExpression</span><span class="o">:</span> <span class="s2">&quot;siteId, checkType&quot;</span><span class="p">,</span> 
  <span class="nx">IndexName</span><span class="o">:</span> <span class="s1">&#39;settings-index&#39;</span><span class="p">,</span>
  <span class="nx">TableName</span><span class="o">:</span> <span class="s2">&quot;stackName-settings&quot;</span>
 <span class="p">});</span>

<span class="cm">/**</span>
<span class="cm">{</span>
<span class="cm">  Items: [</span>
<span class="cm">    {</span>
<span class="cm">      siteId: &#39;site1&#39;,</span>
<span class="cm">      checkType: &#39;text&#39;,</span>
<span class="cm">    },</span>
<span class="cm">    {</span>
<span class="cm">      siteId: &#39;site2&#39;,</span>
<span class="cm">      checkType: &#39;photo&#39;,</span>
<span class="cm">    },</span>
<span class="cm">    ...</span>
<span class="cm">  ],</span>
<span class="cm">  Count: 5,</span>
<span class="cm">  ConsumedCapacity: {}</span>
<span class="cm">}</span>

<span class="cm">*/</span>
</code></pre></div>

<h3 id="available-methods_1">Available Methods<a class="headerlink" href="#available-methods_1" title="Permanent link">&para;</a></h3>
<p>The <code>Utils/dynamodb</code> also comes with more specific and granular methods for specific queries.</p>
<h4 id="dynamodbquerycount">dynamodb.queryCount<a class="headerlink" href="#dynamodbquerycount" title="Permanent link">&para;</a></h4>
<p>This will return the number of results</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span> <span class="nx">dynamodb</span> <span class="kr">from</span> <span class="s2">&quot;Utils/dynamodb&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">count</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">dynamodb</span><span class="p">.</span><span class="nx">queryCount</span><span class="p">(</span>
  <span class="s1">&#39;stackName-settings&#39;</span><span class="p">,</span>
  <span class="s1">&#39;siteId = :siteId&#39;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="s1">&#39;:siteId&#39;</span><span class="o">:</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="s1">&#39;siteId, checkType&#39;</span>
<span class="p">);</span>

<span class="c1">// 5</span>
</code></pre></div>

<h4 id="dynamodbput">dynamodb.put<a class="headerlink" href="#dynamodbput" title="Permanent link">&para;</a></h4>
<p>This will insert a new record. Refer <a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB/DocumentClient.html#put-property">here</a> for response and more information.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span> <span class="nx">dynamodb</span> <span class="kr">from</span> <span class="s2">&quot;Utils/dynamodb&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">dynamodb</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span>
  <span class="s1">&#39;stackName-settings&#39;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="s1">&#39;siteId&#39;</span><span class="o">:</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
    <span class="s1">&#39;checkType&#39;</span><span class="o">:</span> <span class="s1">&#39;text&#39;</span>
  <span class="p">}</span>
<span class="p">);</span>
</code></pre></div>

<h4 id="dynamodbupdate">dynamodb.update<a class="headerlink" href="#dynamodbupdate" title="Permanent link">&para;</a></h4>
<p>This will update an existing record. Refer <a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB/DocumentClient.html#update-property">here</a> for response and more information.</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span> <span class="nx">dynamodb</span> <span class="kr">from</span> <span class="s2">&quot;Utils/dynamodb&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">dynamodb</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span>
  <span class="s1">&#39;stackName-settings&#39;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="s1">&#39;siteId&#39;</span><span class="o">:</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
    <span class="s1">&#39;checkType&#39;</span><span class="o">:</span> <span class="s1">&#39;text&#39;</span>
  <span class="p">},</span>
  <span class="s1">&#39;set checkType = :checkType&#39;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="s1">&#39;:checkType&#39;</span><span class="o">:</span> <span class="s1">&#39;photo&#39;</span>
  <span class="p">}</span>
<span class="p">);</span>
</code></pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../cache/" title="Cache" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Cache
              </span>
            </div>
          </a>
        
        
          <a href="../helpers/" title="Helpers" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Helpers
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 Reflex Media
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.dc02f8ce.js"></script>
      
      <script>app.initialize({version:"1.1.2",url:{base:"../.."}})</script>
      
    
  </body>
</html>