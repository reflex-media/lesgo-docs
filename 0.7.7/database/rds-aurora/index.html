
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A lightweight node.js serverless framework">
      
      
        <meta name="author" content="Sufiyan Rahmat">
      
      
        <link rel="canonical" href="https://reflex-media.github.io/lesgo-docs/0.7.7/database/rds-aurora/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.5">
    
    
      
        <title>RDS Aurora - Lesgo!</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="orange">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#aws-rds-aurora" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the stable version.
  <a href="../../..">
    <strong>Click here to go to stable.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Lesgo!" class="md-header__button md-logo" aria-label="Lesgo!" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.35 10.03A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.03A6.004 6.004 0 0 0 0 14a6 6 0 0 0 6 6h13a5 5 0 0 0 5-5c0-2.64-2.05-4.78-4.65-4.97z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Lesgo!
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              RDS Aurora
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/reflex-media/lesgo/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    reflex-media/lesgo
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Lesgo!" class="md-nav__button md-logo" aria-label="Lesgo!" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.35 10.03A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.03A6.004 6.004 0 0 0 0 14a6 6 0 0 0 6 6h13a5 5 0 0 0 5-5c0-2.64-2.05-4.78-4.65-4.97z"/></svg>

    </a>
    Lesgo!
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/reflex-media/lesgo/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    reflex-media/lesgo
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Prologue
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Prologue" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Prologue
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../prologue/release-notes/" class="md-nav__link">
        Release Notes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../prologue/contribution-guide/" class="md-nav__link">
        Contribution Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/structure/" class="md-nav__link">
        Directory Structure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/deployment/" class="md-nav__link">
        Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/available-scripts/" class="md-nav__link">
        Available Scripts
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          The Basics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="The Basics" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          The Basics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/middleware/" class="md-nav__link">
        Middleware
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/error-handling/" class="md-nav__link">
        Error Handling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Digging Deeper
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Digging Deeper" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Digging Deeper
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../advance/cache/" class="md-nav__link">
        Cache
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../advance/helpers/" class="md-nav__link">
        Helpers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../advance/object-store/" class="md-nav__link">
        Object Store
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../advance/queues/" class="md-nav__link">
        Queues
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../advance/task-scheduling/" class="md-nav__link">
        Task Scheduling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../advance/unit-tests/" class="md-nav__link">
        Unit Tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../advance/full-text-search/" class="md-nav__link">
        Full-Text Search
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../advance/typescript/" class="md-nav__link">
        Typescript
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Security
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Security" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Security
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../security/vpc/" class="md-nav__link">
        VPC
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Database
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Database" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Database
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dynamodb/" class="md-nav__link">
        DynamoDB
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          RDS Aurora
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        RDS Aurora
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aurora-serverless" class="md-nav__link">
    Aurora Serverless
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aurora-provisioned" class="md-nav__link">
    Aurora Provisioned
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-connection" class="md-nav__link">
    Database Connection
  </a>
  
    <nav class="md-nav" aria-label="Database Connection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#persistent-connection-for-rds-proxy" class="md-nav__link">
    Persistent Connection for RDS Proxy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-database-queries" class="md-nav__link">
    Running Database Queries
  </a>
  
    <nav class="md-nav" aria-label="Running Database Queries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#retrieving-all-rows" class="md-nav__link">
    Retrieving All Rows
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieving-a-single-row" class="md-nav__link">
    Retrieving a Single Row
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieving-paginated-rows" class="md-nav__link">
    Retrieving Paginated Rows
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inserting-a-single-record" class="md-nav__link">
    Inserting a Single Record
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updating-an-existing-record" class="md-nav__link">
    Updating an Existing Record
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-query" class="md-nav__link">
    Raw Query
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Packages
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Packages" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Packages
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../packages/firebase/" class="md-nav__link">
        Firebase
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aurora-serverless" class="md-nav__link">
    Aurora Serverless
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aurora-provisioned" class="md-nav__link">
    Aurora Provisioned
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-connection" class="md-nav__link">
    Database Connection
  </a>
  
    <nav class="md-nav" aria-label="Database Connection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#persistent-connection-for-rds-proxy" class="md-nav__link">
    Persistent Connection for RDS Proxy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-database-queries" class="md-nav__link">
    Running Database Queries
  </a>
  
    <nav class="md-nav" aria-label="Running Database Queries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#retrieving-all-rows" class="md-nav__link">
    Retrieving All Rows
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieving-a-single-row" class="md-nav__link">
    Retrieving a Single Row
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieving-paginated-rows" class="md-nav__link">
    Retrieving Paginated Rows
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inserting-a-single-record" class="md-nav__link">
    Inserting a Single Record
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updating-an-existing-record" class="md-nav__link">
    Updating an Existing Record
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-query" class="md-nav__link">
    Raw Query
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/reflex-media/lesgo/edit/master/docs/database/rds-aurora.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



<h1 id="aws-rds-aurora">AWS RDS Aurora<a class="headerlink" href="#aws-rds-aurora" title="Permanent link">&para;</a></h1>
<p>MySQL and PostgreSQL-compatible relational database built for the cloud. Performance and availability of commercial-grade databases at 1/10th the cost.</p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>The database configuration for your application is located at <code>src/config/db.js</code>. Or copy <a href="https://raw.githubusercontent.com/reflex-media/lesgo/master/src/config/db.js">this file</a> to that path.</p>
<h3 id="aurora-serverless">Aurora Serverless<a class="headerlink" href="#aurora-serverless" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As Lesgo! establishes connection to Aurora Serverless via the Data API, prior setup and storing of the credentials on AWS Secret Manager is required. <a href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/data-api.html">Find out more</a>.</p>
</div>
<p>For Aurora Serverless via Data API, create a <code>connections.dataApi</code> configuration as shown below.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// src/config/db.js</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="k">default</span><span class="o">:</span> <span class="s2">&quot;dataApi&quot;</span><span class="p">,</span>
  <span class="nx">connections</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">dataApi</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">secretArn</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_SECRET_ARN</span> <span class="o">||</span> <span class="s2">&quot;secretArnDataApi&quot;</span><span class="p">,</span>
      <span class="nx">secretCommandArn</span><span class="o">:</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_SECRET_COMMAND_ARN</span> <span class="o">||</span> <span class="s2">&quot;secretCommandArnDataApi&quot;</span><span class="p">,</span>
      <span class="nx">resourceArn</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_RESOURCE_ARN</span> <span class="o">||</span> <span class="s2">&quot;resourceArnDataApi&quot;</span><span class="p">,</span>
      <span class="nx">database</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_NAME</span> <span class="o">||</span> <span class="s2">&quot;databaseDataApi&quot;</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">};</span>
</code></pre></div>
<p>You may also simply update the respective environment files in <code>config/environments/.env.*</code> as such:</p>
<div class="highlight"><pre><span></span><code><span class="c"># AWS Secret Manager ARN to allow app db user connect to the specified db</span><span class="w"></span>
<span class="nb">DB_SECRET_ARN</span>=<span class="s2">&quot;&quot;</span><span class="w"></span>

<span class="c"># AWS Secret Manager ARN to allow app command db user connect to the specified db</span><span class="w"></span>
<span class="c"># for running &quot;command&quot; like functions like database schema migration</span><span class="w"></span>
<span class="nb">DB_SECRET_COMMAND_ARN</span>=<span class="s2">&quot;&quot;</span><span class="w"></span>

<span class="c"># AWS Secret Manager ARN for the Aurora Serverless database cluster</span><span class="w"></span>
<span class="nb">DB_RESOURCE_ARN</span>=<span class="s2">&quot;&quot;</span><span class="w"></span>

<span class="c"># Database name to connect to</span><span class="w"></span>
<span class="nb">DB_NAME</span>=<span class="s2">&quot;&quot;</span><span class="w"></span>
</code></pre></div>
<h3 id="aurora-provisioned">Aurora Provisioned<a class="headerlink" href="#aurora-provisioned" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As Lesgo! establishes connection to Aurora Provisioned via the RDS Proxy, prior setup of the RDS Proxy is required. <a href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/rds-proxy.html">Find out more</a>.</p>
</div>
<p>For Aurora Provisioned via RDS Proxy, create a <code>connections.rdsProxy</code> configuration as shown below.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// src/config/db.js</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="k">default</span><span class="o">:</span> <span class="s2">&quot;rdsProxy&quot;</span><span class="p">,</span>
  <span class="nx">connections</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">rdsProxy</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">host</span><span class="o">:</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_RDS_PROXY_HOST</span> <span class="o">||</span>
        <span class="s2">&quot;rds-cluster-proxy.proxy-ek9srsfbg2xc.us-west-2.rds.amazonaws.com&quot;</span><span class="p">,</span>
      <span class="nx">user</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_RDS_PROXY_USER</span> <span class="o">||</span> <span class="s2">&quot;proxyUser&quot;</span><span class="p">,</span>
      <span class="nx">password</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_RDS_PROXY_PASSWORD</span> <span class="o">||</span> <span class="s2">&quot;proxyPass&quot;</span><span class="p">,</span>
      <span class="nx">database</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_NAME</span> <span class="o">||</span> <span class="s2">&quot;dbname&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">rdsProxyRead</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">host</span><span class="o">:</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_RDS_PROXY_HOST_READ</span> <span class="o">||</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_RDS_PROXY_HOST</span> <span class="o">||</span>
        <span class="s2">&quot;rds-cluster-proxy-read-only.proxy-ek9srsfbg2xc.us-west-2.rds.amazonaws.com&quot;</span><span class="p">,</span>
      <span class="nx">user</span><span class="o">:</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_RDS_PROXY_USER_READ</span> <span class="o">||</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_RDS_PROXY_USER</span> <span class="o">||</span>
        <span class="s2">&quot;proxyUser&quot;</span><span class="p">,</span>
      <span class="nx">password</span><span class="o">:</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_RDS_PROXY_PASSWORD_READ</span> <span class="o">||</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_RDS_PROXY_PASSWORD</span> <span class="o">||</span>
        <span class="s2">&quot;proxyPass&quot;</span><span class="p">,</span>
      <span class="nx">database</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DB_NAME</span> <span class="o">||</span> <span class="s2">&quot;dbname&quot;</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">};</span>
</code></pre></div>
<p>You may also simply update the respective environment files in <code>config/environments/env.*</code> as such:</p>
<div class="highlight"><pre><span></span><code><span class="c"># config/environments/.env.*</span><span class="w"></span>

<span class="c"># Domain host of the RDS Proxy</span><span class="w"></span>
<span class="nb">DB_RDS_PROXY_HOST</span>=<span class="s2">&quot;&quot;</span><span class="w"></span>

<span class="c"># Domain host of the RDS Proxy for read-only connection</span><span class="w"></span>
<span class="nb">DB_RDS_PROXY_HOST_READ</span>=<span class="s2">&quot;&quot;</span><span class="w"></span>

<span class="c"># RDS Proxy username</span><span class="w"></span>
<span class="nb">DB_RDS_PROXY_USER</span>=<span class="s2">&quot;&quot;</span><span class="w"></span>

<span class="c"># RDS Proxy password</span><span class="w"></span>
<span class="nb">DB_RDS_PROXY_PASSWORD</span>=<span class="s2">&quot;&quot;</span><span class="w"></span>
</code></pre></div>
<h2 id="database-connection">Database Connection<a class="headerlink" href="#database-connection" title="Permanent link">&para;</a></h2>
<p>Connecting to the database is automatically handled when you execute your query.</p>
<p>For Aurora Serverless (via Data API), this is nothing to worry about as the opening and closing of database connections is handled within Data API itself! Thus, one less worry about managing connection pools.</p>
<p>For Aurora Provisioned (via RDS Proxy), a connection will be opened and closed per every query executed. While this works, it is not efficient as opening and closing a database connection will cost additional time (and money!).</p>
<p>As such, specifically for RDS Proxy, you should make use of Lesgo's persistent connection method <code>db.pConnect()</code>. This should be handled at the Handler level as much as possible.</p>
<h3 id="persistent-connection-for-rds-proxy">Persistent Connection for RDS Proxy<a class="headerlink" href="#persistent-connection-for-rds-proxy" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// src/handlers/utils/ping.js</span>

<span class="k">import</span> <span class="nx">middy</span> <span class="kr">from</span> <span class="s2">&quot;@middy/core&quot;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">httpMiddleware</span> <span class="kr">from</span> <span class="s2">&quot;Middlewares/httpMiddleware&quot;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">ping</span> <span class="kr">from</span> <span class="s2">&quot;Core/utils/ping&quot;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">db</span> <span class="kr">from</span> <span class="s2">&quot;Utils/db&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">originalHandler</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">pConnect</span><span class="p">();</span>

  <span class="k">return</span> <span class="nx">ping</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">input</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="nx">middy</span><span class="p">(</span><span class="nx">originalHandler</span><span class="p">);</span>

<span class="nx">handler</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">httpMiddleware</span><span class="p">({</span> <span class="nx">db</span> <span class="p">}));</span>
</code></pre></div>
<p>Notice the passing of the <code>db</code> object into <code>httpMiddleware()</code>. This is important to allow <code>httpMiddleware</code> to disconnect from RDS Proxy at the end of the lambda execution. Without doing so, you will encounter lambda timeout issues as the db connection is still open.</p>
<p>Should you want to handle the closing of the db connection yourself and without using any of Lesgo!'s middlewares, you can do so as shown below.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// src/handlers/utils/ping.js</span>

<span class="k">import</span> <span class="nx">middy</span> <span class="kr">from</span> <span class="s2">&quot;@middy/core&quot;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">httpMiddleware</span> <span class="kr">from</span> <span class="s2">&quot;Middlewares/httpMiddleware&quot;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">ping</span> <span class="kr">from</span> <span class="s2">&quot;Core/utils/ping&quot;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">db</span> <span class="kr">from</span> <span class="s2">&quot;Utils/db&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">originalHandler</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">pConnect</span><span class="p">();</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">ping</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">input</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">resp</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="nx">middy</span><span class="p">(</span><span class="nx">originalHandler</span><span class="p">);</span>

<span class="nx">handler</span><span class="p">.</span><span class="nx">use</span><span class="p">();</span>
</code></pre></div>
<p>The <code>finally</code> in <code>try catch</code> is important to allow for a safe disconnection of the db.</p>
<h2 id="running-database-queries">Running Database Queries<a class="headerlink" href="#running-database-queries" title="Permanent link">&para;</a></h2>
<h3 id="retrieving-all-rows">Retrieving All Rows<a class="headerlink" href="#retrieving-all-rows" title="Permanent link">&para;</a></h3>
<p><code>db.select()</code> will return a promised array of objects.</p>
<div class="highlight"><pre><span></span><code><span class="nx">db</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span>
  <span class="nx">sql</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">sqlParams</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
  <span class="nx">connectionOpts</span><span class="o">?:</span> <span class="nb">Object</span> <span class="o">=</span> <span class="p">{}</span>
<span class="p">);</span>
</code></pre></div>
<p><strong>Usage</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="nx">db</span> <span class="kr">from</span> <span class="s2">&quot;Utils/db&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span>
  <span class="s2">&quot;SELECT * FROM users WHERE is_deleted = :isDeleted&quot;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">isDeleted</span><span class="o">:</span> <span class="mf">0</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">);</span>
</code></pre></div>
<h3 id="retrieving-a-single-row">Retrieving a Single Row<a class="headerlink" href="#retrieving-a-single-row" title="Permanent link">&para;</a></h3>
<p><code>db.selectFirst()</code> will return a promised object of a single record.</p>
<div class="highlight"><pre><span></span><code><span class="nx">db</span><span class="p">.</span><span class="nx">selectFirst</span><span class="p">(</span>
  <span class="nx">sql</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">sqlParams</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
  <span class="nx">connectionOpts</span><span class="o">?:</span> <span class="nb">Object</span> <span class="o">=</span> <span class="p">{}</span>
<span class="p">);</span>
</code></pre></div>
<p><strong>Usage</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="nx">db</span> <span class="kr">from</span> <span class="s2">&quot;Utils/db&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">selectFirst</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM users WHERE id = :id&quot;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">id</span><span class="o">:</span> <span class="mf">1</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div>
<h3 id="retrieving-paginated-rows">Retrieving Paginated Rows<a class="headerlink" href="#retrieving-paginated-rows" title="Permanent link">&para;</a></h3>
<p><code>db.selectPaginate()</code> will return a promised object with pagination data and itemized rows.</p>
<div class="highlight"><pre><span></span><code><span class="nx">db</span><span class="p">.</span><span class="nx">selectPaginate</span><span class="p">(</span>
  <span class="nx">sql</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">sqlParams</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
  <span class="nx">perPage</span><span class="o">?:</span> <span class="nb">Number</span> <span class="o">=</span> <span class="mf">10</span><span class="p">,</span>
  <span class="nx">currentPage</span><span class="o">?:</span> <span class="nb">Number</span> <span class="o">=</span> <span class="mf">1</span><span class="p">,</span>
  <span class="nx">total</span><span class="o">?:</span> <span class="nb">Number</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">connectionOpts</span><span class="o">?:</span> <span class="nb">Object</span> <span class="o">=</span> <span class="p">{}</span>
<span class="p">);</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When <code>total</code> is not provided, <code>db.selectPaginate()</code> will run 2 separate queries to first fetch all the record count, followed by the actual query with <code>OFFSET</code> and <code>LIMIT</code>. It is strongly advisable to pass along the <code>total</code> for best performance.</p>
</div>
<p><strong>Usage</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="nx">db</span> <span class="kr">from</span> <span class="s2">&quot;Utils/db&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">selectPaginate</span><span class="p">(</span>
  <span class="s2">&quot;SELECT * FROM users WHERE is_deleted = :isDeleted&quot;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">isDeleted</span><span class="o">:</span> <span class="mf">0</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">perPage</span><span class="o">:</span> <span class="mf">1</span><span class="p">,</span>
    <span class="nx">currentPage</span><span class="o">:</span> <span class="mf">1</span><span class="p">,</span>
    <span class="nx">total</span><span class="o">:</span> <span class="mf">25</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">);</span>
</code></pre></div>
<h3 id="inserting-a-single-record">Inserting a Single Record<a class="headerlink" href="#inserting-a-single-record" title="Permanent link">&para;</a></h3>
<p><code>db.insert()</code> will insert a new record and return only the newly inserted primary key.</p>
<div class="highlight"><pre><span></span><code><span class="nx">db</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span>
  <span class="nx">sql</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">sqlParams</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
  <span class="nx">connectionOpts</span><span class="o">?:</span> <span class="nb">Object</span> <span class="o">=</span> <span class="p">{}</span>
<span class="p">);</span>
</code></pre></div>
<p><strong>Usage</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="nx">db</span> <span class="kr">from</span> <span class="s2">&quot;Utils/db&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">insertId</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span>
  <span class="s2">&quot;INSERT INTO users(username,email) VALUES (:username, :email)&quot;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">username</span><span class="o">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span>
    <span class="nx">email</span><span class="o">:</span> <span class="s2">&quot;john@mail.com&quot;</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">);</span>
</code></pre></div>
<p>A much better approach to inserting records is to first validate the fields and then inserting it with <code>Utils/prepSQLInsertParams</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="nx">prepSQLInsertParams</span> <span class="kr">from</span> <span class="s2">&quot;Utils/prepSQLInsertParams&quot;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">validateFields</span> <span class="kr">from</span> <span class="s2">&quot;Utils/validateFields&quot;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">db</span> <span class="kr">from</span> <span class="s2">&quot;Utils/db&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">validFields</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="s2">&quot;username&quot;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span>
<span class="p">];</span>

<span class="kd">let</span> <span class="nx">validated</span> <span class="o">=</span> <span class="nx">validateFields</span><span class="p">({</span> <span class="p">...</span><span class="nx">params</span> <span class="p">},</span> <span class="nx">validFields</span><span class="p">);</span>

<span class="kd">const</span> <span class="p">{</span> <span class="nx">insertColumns</span><span class="p">,</span> <span class="nx">insertValues</span><span class="p">,</span> <span class="nx">insertFields</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">prepSQLInsertParams</span><span class="p">(</span>
  <span class="nx">validated</span><span class="p">,</span>
  <span class="nx">validFields</span>
<span class="p">);</span>

<span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span>
  <span class="sb">`INSERT INTO users(</span><span class="si">${</span><span class="nx">insertColumns</span><span class="si">}</span><span class="sb">) VALUES(</span><span class="si">${</span><span class="nx">insertValues</span><span class="si">}</span><span class="sb">)`</span><span class="p">,</span>
  <span class="nx">insertFields</span>
<span class="p">);</span>
</code></pre></div>
<p>Learn more about <a href="../../advance/helpers/#field-validator">Utils/validateFields</a> and <a href="../../advance/helpers/#prep-insert-sql-parameter">Utils/prepSQLInsertParams</a>.</p>
<h3 id="updating-an-existing-record">Updating an Existing Record<a class="headerlink" href="#updating-an-existing-record" title="Permanent link">&para;</a></h3>
<p><code>db.update()</code> will update an existing record and throw an Error if no record found for update.</p>
<div class="highlight"><pre><span></span><code><span class="nx">db</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span>
  <span class="nx">sql</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">sqlParams</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
  <span class="nx">connectionOpts</span><span class="o">?:</span> <span class="nb">Object</span> <span class="o">=</span> <span class="p">{}</span>
<span class="p">);</span>
</code></pre></div>
<p><strong>Usage</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="nx">db</span> <span class="kr">from</span> <span class="s2">&quot;Utils/db&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">insertId</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span>
  <span class="s2">&quot;UPDATE users SET username=:username, email=:email, updated_at=now()) WHERE id=:id&quot;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="mf">1</span><span class="p">,</span>
    <span class="nx">username</span><span class="o">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span>
    <span class="nx">email</span><span class="o">:</span> <span class="s2">&quot;john@mail.com&quot;</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">);</span>
</code></pre></div>
<p>As with insert, updatating an existing record is best done with <code>Utils/prepSQLUpdateParams</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="nx">prepSQLUpdateParams</span> <span class="kr">from</span> <span class="s2">&quot;Utils/prepSQLUpdateParams&quot;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">validateFields</span> <span class="kr">from</span> <span class="s2">&quot;Utils/validateFields&quot;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">db</span> <span class="kr">from</span> <span class="s2">&quot;Utils/db&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">validFields</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="s2">&quot;username&quot;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span>
<span class="p">];</span>

<span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">username</span><span class="o">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span>
  <span class="nx">email</span><span class="o">:</span> <span class="s2">&quot;john@mail.com&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="kd">let</span> <span class="nx">validated</span> <span class="o">=</span> <span class="nx">validateFields</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">validFields</span><span class="p">);</span>

<span class="kd">const</span> <span class="p">{</span> <span class="nx">updateColumnValues</span><span class="p">,</span> <span class="nx">wherePrimaryKey</span><span class="p">,</span> <span class="nx">updateFields</span> <span class="p">}</span> <span class="o">=</span>
  <span class="nx">prepSQLUpdateParams</span><span class="p">(</span><span class="nx">validated</span><span class="p">,</span> <span class="nx">validFields</span><span class="p">);</span>

<span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span>
  <span class="sb">`UPDATE users SET </span><span class="si">${</span><span class="nx">updateColumnValues</span><span class="si">}</span><span class="sb">, updated_at=NOW() WHERE </span><span class="si">${</span><span class="nx">wherePrimaryKey</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
  <span class="nx">updateFields</span>
<span class="p">);</span>
</code></pre></div>
<p>Learn more about <a href="../../advance/helpers/#prep-update-sql-parameter">Utils/prepSQLUpdateParams</a>.</p>
<h3 id="raw-query">Raw Query<a class="headerlink" href="#raw-query" title="Permanent link">&para;</a></h3>
<p>All of the above executes <code>db.query()</code>. You may also execute your queries directly and get a raw response.</p>
<div class="highlight"><pre><span></span><code><span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span>
  <span class="nx">sql</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">sqlParams</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
  <span class="nx">connectionOpts</span><span class="o">?:</span> <span class="nb">Object</span> <span class="o">=</span> <span class="p">{}</span>
<span class="p">);</span>
</code></pre></div>
<p><strong>Usage</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">import</span> <span class="nx">db</span> <span class="kr">from</span> <span class="s2">&quot;Utils/db&quot;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM users WHERE id = :id&quot;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">id</span><span class="o">:</span> <span class="mf">1</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../dynamodb/" class="md-footer__link md-footer__link--prev" aria-label="Previous: DynamoDB" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              DynamoDB
            </div>
          </div>
        </a>
      
      
        
        <a href="../../packages/firebase/" class="md-footer__link md-footer__link--next" aria-label="Next: Firebase" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Firebase
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2019 Reflex Media
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.bd0b6b67.min.js", "version": {"provider": "mike", "default": "stable"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.467223ff.min.js"></script>
      
    
  </body>
</html>